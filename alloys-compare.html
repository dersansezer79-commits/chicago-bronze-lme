<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Chicago Bronze — Alloy Comparison</title>
<style>
  :root{--bg:#0b0e13;--card:#0f172a;--txt:#e5e7eb;--muted:#94a3b8;--brand:#38bdf8;--bronze1:#a97142;--bronze2:#6e4a2c}
  *{box-sizing:border-box}
  body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;color:var(--txt);
       background:radial-gradient(1200px 600px at 70% -10%, rgba(110,84,43,.22), transparent 60%),
                  radial-gradient(900px 500px at -10% 90%, rgba(180,120,45,.14), transparent 60%),
                  radial-gradient(600px 400px at 120% 50%, rgba(80,50,20,.12), transparent 60%), #0b0e13;}
  .wrap{max-width:1240px;margin:24px auto;padding:0 18px}
  .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:14px}
  @media (max-width:1050px){.grid{grid-template-columns:1fr}}
  .card{background:linear-gradient(180deg,rgba(255,255,255,.04),rgba(255,255,255,.02));border:1px solid rgba(255,255,255,.06);
        border-radius:16px;padding:14px;display:flex;flex-direction:column;gap:10px;min-height:540px}
  .toprow{display:flex;gap:8px;align-items:center;justify-content:space-between}
  .name{font-weight:900;font-size:16px}
  select{width:100%;padding:10px 12px;border-radius:10px;border:1px solid rgba(226,232,240,.12);
         background:rgba(15,23,42,.85);color:var(--txt);font-size:14px}
  .muted{color:var(--muted);font-size:12px}
  .pill{padding:4px 8px;border-radius:999px;background:rgba(56,189,248,.12);color:#7dd3fc;font-size:11px;font-weight:700}
  .specs{display:grid;grid-template-columns:1fr 1fr;gap:8px}
  .kv{background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.06);border-radius:10px;padding:8px}
  .kv .k{color:var(--muted);font-size:12px}
  .kv .v{font-weight:800}
  .bars{display:flex;gap:4px}
  .bar{width:16px;height:10px;border-radius:3px;background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.1)}
  .bar.on{background:rgba(125,211,252,.35);border-color:rgba(125,211,252,.6)}
  .chem{font-size:12px;color:#dbeafe;line-height:1.25}
  .foot{margin-top:auto;display:flex;align-items:center;justify-content:space-between;gap:8px}

  /* Calculator-themed buttons (match index.html) */
  .btn{display:inline-block;width:100%;padding:12px 13px;border-radius:12px;border:0;cursor:pointer;
       font-weight:800;text-align:center;text-decoration:none;
       background:linear-gradient(180deg,#60a5fa,#38bdf8);color:#001428}
  .btn:focus{outline:2px solid rgba(56,189,248,.35)}
  .btn[disabled]{opacity:.6;cursor:not-allowed}
</style>
</head>
<body>
  <div class="wrap">
    <div class="grid" id="grid"></div>
  </div>

<script>
/* ===== SETTINGS ===== */
const ALLOYS_URL = 'https://dersansezer79-commits.github.io/chicago-bronze-lme/alloys.json?t=' + Date.now();
const DEFAULT_KEYS = ['C93200_SAE660','C95400_AlBronze','C86300_MnBronze'];

/* ===== UTIL ===== */
const fmt = (n,d=0)=>Number(n).toLocaleString(undefined,{minimumFractionDigits:d,maximumFractionDigits:d});
function bars(n){ n=Math.max(0,Math.min(5,Number(n)||0)); let h='<div class="bars">';
  for(let i=1;i<=5;i++) h+=`<div class="bar${i<=n?' on':''}"></div>`; return h+'</div>'; }
function familyGuess(label){
  const L=(label||'').toLowerCase();
  if (L.includes('sae 660')||L.includes('c932')||L.includes('leaded')) return 'Lead Tin Bronze';
  if (L.includes('c863')||L.includes('manganese')) return 'Manganese Bronze';
  if (L.includes('al bronze')||L.includes('c95')||L.includes('c63')) return 'Aluminum Bronze';
  if (L.includes('tin bronze')||L.includes('c90')) return 'Tin Bronze';
  return '';
}
function chemLine(obj){
  if (!obj || typeof obj!=='object') return '—';
  const parts = Object.entries(obj)
    .filter(([k,v])=>Number.isFinite(v))
    .sort((a,b)=>b[1]-a[1])
    .slice(0,5)
    .map(([k,v])=>`${k} ${v}%`);
  return parts.length? parts.join(' • ') : '—';
}

/* ===== RENDER ONE SLOT ===== */
function renderSlot(container, alloysMap, curKey){
  container.innerHTML = '';
  const keys = Object.keys(alloysMap);
  const sel = document.createElement('select'); sel.style.width='100%';
  for (const k of keys){
    const a=alloysMap[k], label=a.label||k.replaceAll('_',' ');
    const opt = document.createElement('option'); opt.value=k; opt.textContent=label; sel.appendChild(opt);
  }
  if (curKey && keys.includes(curKey)) sel.value=curKey;

  const a = alloysMap[sel.value] || {};
  const label = a.label || sel.value.replaceAll('_',' ');
  const fam = a.family || familyGuess(label);

  const card = document.createElement('div'); card.className='card';
  const top = document.createElement('div'); top.className='toprow';
  top.innerHTML = `<div>
      <div class="name">${label}</div>
      <div class="muted">${sel.value}${fam?` • <span class="pill">${fam}</span>`:''}</div>
    </div>`;
  top.appendChild(sel);
  card.appendChild(top);

  const dens = (a.density_kg_m3!=null)? `${fmt(a.density_kg_m3)} kg/m³` : '—';
  const BHN  = (a.hardness_BHN!=null)? `${fmt(a.hardness_BHN)}` : '—';
  const TS   = (a.tensile_MPa!=null)? `${fmt(a.tensile_MPa)}` : '—';
  const YS   = (a.yield_MPa!=null)? `${fmt(a.yield_MPa)}` : '—';
  const EL   = (a.elongation_pct!=null)? `${fmt(a.elongation_pct)} %` : '—';
  const machR = a.machinability?.rating||0;
  const machT = a.machinability?.text||'—';

  const specs = document.createElement('div'); specs.className='specs';
  specs.innerHTML = `
    <div class="kv"><div class="k">Machinability</div><div class="v" style="display:flex;align-items:center;gap:6px">${bars(machR)} <span class="muted">${machT}</span></div></div>
    <div class="kv"><div class="k">Density</div><div class="v">${dens}</div></div>
    <div class="kv"><div class="k">Hardness (BHN)</div><div class="v">${BHN}</div></div>
    <div class="kv"><div class="k">Tensile (MPa)</div><div class="v">${TS}</div></div>
    <div class="kv"><div class="k">Yield (MPa)</div><div class="v">${YS}</div></div>
    <div class="kv"><div class="k">Elongation (%)</div><div class="v">${EL}</div></div>
  `;
  card.appendChild(specs);

  const chem = document.createElement('div');
  chem.className='chem';
  chem.textContent = 'Chemistry: ' + chemLine(a.composition);
  card.appendChild(chem);

  const foot = document.createElement('div'); foot.className='foot';
  const hint = document.createElement('div'); hint.className='muted'; hint.textContent='Price this alloy in the calculator';
  const cta = document.createElement('a');
  cta.textContent='Price this alloy →';
  cta.href='https://www.chicago-bronze.com/price-calculator';
  cta.target='_blank';
  cta.rel='noopener';
  cta.className='btn';
  foot.appendChild(hint); foot.appendChild(cta);
  card.appendChild(foot);

  sel.addEventListener('change', ()=> renderSlot(container, alloysMap, sel.value));
  container.appendChild(card);
}

/* ===== LOAD + BUILD ===== */
(async function(){
  let alloys={};
  try{
    const r=await fetch(ALLOYS_URL,{cache:'no-store'}); const j=await r.json();
    alloys = j.alloys || j || {};
  }catch(e){
    document.getElementById('grid').innerHTML = '<div class="card"><div class="muted">Could not load alloys.json</div></div>';
    return;
  }
  const grid = document.getElementById('grid');
  for (let i=0;i<3;i++){
    const col = document.createElement('div'); grid.appendChild(col);
    const key = DEFAULT_KEYS[i] && alloys[DEFAULT_KEYS[i]] ? DEFAULT_KEYS[i] : Object.keys(alloys)[i] || null;
    renderSlot(col, alloys, key);
  }
})();
</script>
</body>
</html>
